import requests
import json
import os
import time
from discord_webhook import DiscordWebhook, DiscordEmbed
from bs4 import BeautifulSoup

# ================= 설정 =================
WEBHOOK_URL = os.environ.get('WEBHOOK_PRIVATE')

if not WEBHOOK_URL:
    print("⚠️ 오류: WEBHOOK_PRIVATE 설정이 필요합니다.")
    exit()

HISTORY_FILE = "sent_steamos.json"
# 감시 키워드
KEYWORDS = ["Preview", "SteamOS", "Client Update", "Beta", "Stable"]
# =======================================

def load_history():
    if os.path.exists(HISTORY_FILE):
        with open(HISTORY_FILE, "r", encoding='utf-8') as f:
            try:
                return json.load(f)
            except:
                return []
    return []

def save_history(history):
    with open(HISTORY_FILE, "w", encoding='utf-8') as f:
        json.dump(history, f, ensure_ascii=False)

def fetch_steamos_news():
    url = "https://api.steampowered.com/ISteamNews/GetNewsForApp/v2/?appid=1675200&count=10&format=json"
    
    try:
        response = requests.get(url, timeout=10)
        data = response.json()
        news_items = data['appnews']['newsitems']
        
        updates = []
        for item in news_items:
            title = item['title']
            
            # 키워드 체크
            if any(k.lower() in
